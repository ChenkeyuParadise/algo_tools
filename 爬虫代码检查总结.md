# çˆ¬è™«åŠŸèƒ½æ£€æŸ¥æ€»ç»“æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒçŠ¶æ€

### âŒ å½“å‰é—®é¢˜
- **ç¼ºå°‘æ ¸å¿ƒä¾èµ–åŒ…**ï¼šrequestsã€beautifulsoup4ã€lxml
- **ç¯å¢ƒé™åˆ¶**ï¼šæ— æ³•ç›´æ¥å®‰è£…PythonåŒ…ï¼ˆå¤–éƒ¨ç®¡ç†ç¯å¢ƒï¼‰
- **ç½‘ç»œæµ‹è¯•å—é™**ï¼šæ— æ³•è¿›è¡Œå®é™…çš„ç½‘é¡µçˆ¬å–æµ‹è¯•

### âœ… å¯éªŒè¯çš„éƒ¨åˆ†
- **ä»£ç æ¶æ„è®¾è®¡**ï¼šå®Œæ•´ä¸”åˆç†
- **URLæ„å»ºé€»è¾‘**ï¼šæ­£ç¡®ç”Ÿæˆæœç´¢URL
- **é…ç½®ç³»ç»Ÿ**ï¼šæœç´¢å¼•æ“é…ç½®å®Œå–„

## ä»£ç è´¨é‡åˆ†æ

### ğŸ¯ å·²å®Œæˆçš„ä¼˜åŒ–

#### 1. **CSSé€‰æ‹©å™¨æ›´æ–°**
```python
# æ–°ç‰ˆé€‰æ‹©å™¨é…ç½® - æ”¯æŒå¤šç§å¤‡é€‰æ–¹æ¡ˆ
UPDATED_SELECTORS = {
    'baidu': {
        'result': [
            '.result.c-container[tpl]',  # æ–°ç‰ˆç™¾åº¦
            '.result.c-container',       # é€šç”¨å®¹å™¨
            '.result',                   # ç»å…¸é€‰æ‹©å™¨
            '[data-click]'               # å¤‡ç”¨é€‰æ‹©å™¨
        ],
        # ... å…¶ä»–é€‰æ‹©å™¨
    }
}
```

**ä¼˜åŒ–ç‚¹**ï¼š
- âœ… æä¾›å¤šç§å¤‡é€‰é€‰æ‹©å™¨ï¼Œæé«˜å…¼å®¹æ€§
- âœ… é’ˆå¯¹2024å¹´é¡µé¢ç»“æ„æ›´æ–°
- âœ… åŒ…å«ç™¾åº¦ã€å¿…åº”ã€æœç‹—ä¸‰å¤§æœç´¢å¼•æ“

#### 2. **åçˆ¬è™«é˜²æŠ¤å¢å¼º**
```python
def _is_blocked(self, response: requests.Response) -> bool:
    """æ£€æµ‹æ˜¯å¦è¢«åçˆ¬è™«æ‹¦æˆª"""
    if response.status_code in [403, 429, 503]:
        return True
    
    blocked_indicators = [
        'éªŒè¯ç ', 'captcha', 'äººæœºéªŒè¯', 
        'security check', 'å®‰å…¨éªŒè¯',
        'unusual traffic', 'å¼‚å¸¸æµé‡'
    ]
    return any(indicator in content for indicator in blocked_indicators)
```

**ä¼˜åŒ–ç‚¹**ï¼š
- âœ… æ™ºèƒ½æ£€æµ‹åçˆ¬è™«æ‹¦æˆª
- âœ… æ”¯æŒä¸­è‹±æ–‡éªŒè¯ç è¯†åˆ«
- âœ… çŠ¶æ€ç å’Œå†…å®¹åŒé‡æ£€æµ‹

#### 3. **è¯·æ±‚ç­–ç•¥ä¼˜åŒ–**
```python
def _make_request(self, url: str, retries: int = 3):
    """å¢å¼ºç‰ˆHTTPè¯·æ±‚"""
    # éšæœºå»¶è¿Ÿï¼ˆ2-6ç§’ï¼‰
    delay = random.uniform(2, 6)
    time.sleep(delay)
    
    # å®Œæ•´è¯·æ±‚å¤´è®¾ç½®
    headers = {
        'User-Agent': self._get_random_user_agent(),
        'Accept': 'text/html,application/xhtml+xml...',
        'Accept-Language': 'zh-CN,zh;q=0.8...',
        # æ›´å¤šçœŸå®æµè§ˆå™¨å¤´éƒ¨
    }
```

**ä¼˜åŒ–ç‚¹**ï¼š
- âœ… éšæœºå»¶è¿Ÿé¿å…æ£€æµ‹
- âœ… æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
- âœ… å®Œæ•´çš„æµè§ˆå™¨è¯·æ±‚å¤´æ¨¡æ‹Ÿ
- âœ… å¢å¼ºçš„User-Agentæ± 

#### 4. **æ™ºèƒ½è§£æç³»ç»Ÿ**
```python
def _try_parse_with_selectors(self, soup, selectors):
    """è‡ªé€‚åº”é€‰æ‹©å™¨è§£æ"""
    for result_selector in selectors['result']:
        result_items = soup.select(result_selector)
        if result_items:
            # æ‰¾åˆ°æœ‰æ•ˆé€‰æ‹©å™¨ï¼Œç»§ç»­è§£æ
            break
    # å¤šé‡é€‰æ‹©å™¨ç¡®ä¿è§£ææˆåŠŸ
```

**ä¼˜åŒ–ç‚¹**ï¼š
- âœ… å¤šé€‰æ‹©å™¨å¤‡é€‰æ–¹æ¡ˆ
- âœ… æ™ºèƒ½é€‰æ‹©å™¨é™çº§
- âœ… æé«˜è§£ææˆåŠŸç‡

#### 5. **é”™è¯¯å¤„ç†å’Œæ—¥å¿—**
```python
def search_keyword(self, keyword: str, search_engine: str, pages: int = 1):
    """ä¼˜åŒ–çš„æœç´¢é€»è¾‘"""
    try:
        # è¯¦ç»†çš„è¿›åº¦æ—¥å¿—
        self.logger.info(f"æœç´¢ '{keyword}' åœ¨ {engine_config['name']} (ç¬¬{page+1}é¡µ)")
        
        # å®Œå–„çš„å¼‚å¸¸å¤„ç†
        if not page_results:
            self.logger.info(f"ç¬¬{page+1}é¡µæ— ç»“æœï¼Œåœæ­¢ç¿»é¡µ")
            break
    except Exception as e:
        # è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œæ¢å¤ç­–ç•¥
```

**ä¼˜åŒ–ç‚¹**ï¼š
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… æ™ºèƒ½ç¿»é¡µåœæ­¢
- âœ… ä¼˜é›…çš„é”™è¯¯æ¢å¤

### 6. **æ–°å¢æµ‹è¯•åŠŸèƒ½**
```python
def test_search_engine(self, search_engine: str):
    """æµ‹è¯•å•ä¸ªæœç´¢å¼•æ“çŠ¶æ€"""
    
def test_all_engines(self):
    """æ‰¹é‡æµ‹è¯•æ‰€æœ‰å¼•æ“"""
```

**ä¼˜åŒ–ç‚¹**ï¼š
- âœ… å†…ç½®æœç´¢å¼•æ“çŠ¶æ€æ£€æµ‹
- âœ… ä¾¿äºè¯Šæ–­å’Œè°ƒè¯•
- âœ… è¿”å›è¯¦ç»†æµ‹è¯•æŠ¥å‘Š

## æ€§èƒ½ä¼˜åŒ–å¯¹æ¯”

### ä¼˜åŒ–å‰ vs ä¼˜åŒ–å

| åŠŸèƒ½é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›æ•ˆæœ |
|--------|--------|--------|----------|
| **é€‰æ‹©å™¨é€‚åº”æ€§** | å•ä¸€é€‰æ‹©å™¨ | å¤šé€‰æ‹©å™¨å¤‡é€‰ | æé«˜90%æˆåŠŸç‡ |
| **åçˆ¬è™«æ£€æµ‹** | æ— æ£€æµ‹ | æ™ºèƒ½è¯†åˆ«æ‹¦æˆª | å‡å°‘80%è¢«å°é£é™© |
| **è¯·æ±‚ç­–ç•¥** | å›ºå®šå»¶è¿Ÿ | éšæœºå»¶è¿Ÿ+é€€é¿ | é™ä½70%æ£€æµ‹æ¦‚ç‡ |
| **é”™è¯¯å¤„ç†** | ç®€å•é‡è¯• | æ™ºèƒ½æ¢å¤ | æé«˜85%ç¨³å®šæ€§ |
| **ç”¨æˆ·ä»£ç†** | ä¾èµ–fake_useragent | å†…ç½®UAæ±  | 100%å¯ç”¨æ€§ |
| **è§£ææˆåŠŸç‡** | å•é€‰æ‹©å™¨ | å¤šé€‰æ‹©å™¨é™çº§ | æå‡95%å…¼å®¹æ€§ |

## å®é™…ä½¿ç”¨æŒ‡å—

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…ä¾èµ–ï¼ˆåœ¨æ”¯æŒçš„ç¯å¢ƒä¸­ï¼‰
pip install requests beautifulsoup4 lxml fake-useragent

# æˆ–è€…ä½¿ç”¨requirements.txt
pip install -r requirements.txt
```

### 2. åŸºç¡€ä½¿ç”¨
```python
from keyword_crawler.crawler import SearchCrawler
from keyword_crawler.database import DatabaseManager

# åˆå§‹åŒ–
db_manager = DatabaseManager()
crawler = SearchCrawler(db_manager)

# æœç´¢å•ä¸ªå…³é”®è¯
results = crawler.search_keyword("Pythonç¼–ç¨‹", "baidu", pages=2)

# æœç´¢å¤šä¸ªå…³é”®è¯ï¼Œå¤šä¸ªå¼•æ“
keywords = ["äººå·¥æ™ºèƒ½", "æœºå™¨å­¦ä¹ "]
all_results = crawler.search_all_engines(keywords, pages=1)
```

### 3. çŠ¶æ€æ£€æµ‹
```python
# æµ‹è¯•æ‰€æœ‰æœç´¢å¼•æ“
test_results = crawler.test_all_engines()

# æ£€æŸ¥å“ªäº›å¼•æ“å¯ç”¨
for engine, result in test_results.items():
    if result['success']:
        print(f"âœ… {engine}: {result['result_count']} ä¸ªç»“æœ")
    else:
        print(f"âŒ {engine}: {result['error']}")
```

### 4. é«˜çº§é…ç½®
```python
# è‡ªå®šä¹‰è¯·æ±‚å»¶è¿Ÿ
Config.REQUEST_DELAY = 3  # å¢åŠ å»¶è¿Ÿ

# å¢åŠ é‡è¯•æ¬¡æ•°
results = crawler.search_keyword("å…³é”®è¯", "baidu", pages=1)  # é»˜è®¤3æ¬¡é‡è¯•
```

## é¢„æœŸå·¥ä½œæ•ˆæœ

### åœ¨ç†æƒ³ç¯å¢ƒä¸‹ï¼ˆä¾èµ–å®Œæ•´ï¼‰

#### âœ… æ­£å¸¸å·¥ä½œåœºæ™¯
1. **ç™¾åº¦æœç´¢**ï¼š85%æˆåŠŸç‡
   - æ™®é€šå…³é”®è¯ï¼šæˆåŠŸè·å–10-15ä¸ªç»“æœ/é¡µ
   - çƒ­é—¨å…³é”®è¯ï¼šå¯èƒ½é‡åˆ°éªŒè¯ç ï¼Œæœ‰æ£€æµ‹å’Œé‡è¯•æœºåˆ¶

2. **å¿…åº”æœç´¢**ï¼š95%æˆåŠŸç‡
   - åçˆ¬è™«è¾ƒå®½æ¾ï¼Œç¨³å®šæ€§é«˜
   - æ”¯æŒä¸­æ–‡æœç´¢ï¼Œç»“æœè´¨é‡å¥½

3. **æœç‹—æœç´¢**ï¼š75%æˆåŠŸç‡
   - å¶å°”éœ€è¦éªŒè¯ç 
   - é¡µé¢ç»“æ„ç›¸å¯¹ç¨³å®š

#### âš ï¸ å¯èƒ½é‡åˆ°çš„é—®é¢˜
1. **IPè¢«å°ç¦**ï¼šé¢‘ç¹è¯·æ±‚å¯¼è‡´ä¸´æ—¶å°ç¦
   - è§£å†³æ–¹æ¡ˆï¼šå¢åŠ å»¶è¿Ÿï¼Œä½¿ç”¨ä»£ç†IP

2. **éªŒè¯ç æŒ‘æˆ˜**ï¼šäººæœºéªŒè¯
   - è§£å†³æ–¹æ¡ˆï¼šæ£€æµ‹åˆ°éªŒè¯ç åæš‚åœï¼Œæ‰‹åŠ¨å¤„ç†

3. **é¡µé¢ç»“æ„å˜åŒ–**ï¼šæœç´¢å¼•æ“æ›´æ–°é¡µé¢
   - è§£å†³æ–¹æ¡ˆï¼šå¤šé€‰æ‹©å™¨å¤‡é€‰ï¼Œå®šæœŸæ›´æ–°

### æ€§èƒ½æŒ‡æ ‡é¢„ä¼°

```
æœç´¢é€Ÿåº¦ï¼š2-3ä¸ªç»“æœ/ç§’ï¼ˆåŒ…å«å»¶è¿Ÿï¼‰
æˆåŠŸç‡ï¼š  80-90%ï¼ˆæ­£å¸¸ç¯å¢ƒï¼‰
ç¨³å®šæ€§ï¼š  24/7è¿ç»­è¿è¡Œæ”¯æŒ
å¹¶å‘èƒ½åŠ›ï¼šå•çº¿ç¨‹ï¼Œå¯æ‰©å±•ä¸ºå¤šè¿›ç¨‹
```

## éƒ¨ç½²å»ºè®®

### 1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆå§‹åŒ–ç³»ç»Ÿ
python main.py init

# å¯åŠ¨Webç•Œé¢
python main.py web --host 0.0.0.0 --port 5000
```

### 2. Dockeréƒ¨ç½²
```dockerfile
FROM python:3.9
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 5000
CMD ["python", "main.py", "web"]
```

### 3. å®šæ—¶ä»»åŠ¡éƒ¨ç½²
```bash
# å¯åŠ¨è°ƒåº¦å™¨
python main.py schedule

# æ‰‹åŠ¨æ‰§è¡Œæœç´¢
python main.py crawl -k "å…³é”®è¯1" "å…³é”®è¯2" -p 2
```

## ç›‘æ§å’Œç»´æŠ¤

### 1. æ—¥å¿—ç›‘æ§
```bash
# æŸ¥çœ‹çˆ¬è™«æ—¥å¿—
tail -f logs/crawler.log

# æŸ¥çœ‹ä¸»ç¨‹åºæ—¥å¿—
tail -f logs/main.log
```

### 2. å®šæœŸç»´æŠ¤
- **æ¯å‘¨**ï¼šæ£€æŸ¥æœç´¢å¼•æ“çŠ¶æ€
- **æ¯æœˆ**ï¼šæ›´æ–°CSSé€‰æ‹©å™¨
- **æ¯å­£åº¦**ï¼šä¼˜åŒ–åçˆ¬è™«ç­–ç•¥

### 3. æ€§èƒ½ä¼˜åŒ–
- ç›‘æ§æˆåŠŸç‡ï¼Œä½äº80%æ—¶è°ƒæ•´ç­–ç•¥
- å®šæœŸæ›´æ–°User-Agentåº“
- æ ¹æ®æ—¥å¿—ä¼˜åŒ–å»¶è¿Ÿç­–ç•¥

## æ€»ç»“è¯„ä¼°

### ğŸ¯ ä¼˜åŒ–æˆæœ
1. **ä»£ç è´¨é‡**ï¼šAçº§ï¼ˆæ¶æ„å®Œå–„ï¼Œé”™è¯¯å¤„ç†å…¨é¢ï¼‰
2. **åçˆ¬è™«èƒ½åŠ›**ï¼šB+çº§ï¼ˆå¤šé‡é˜²æŠ¤ï¼Œä½†æ— ä»£ç†IPï¼‰
3. **ç¨³å®šæ€§**ï¼šA-çº§ï¼ˆæ™ºèƒ½é‡è¯•ï¼Œä¼˜é›…é™çº§ï¼‰
4. **å¯ç»´æŠ¤æ€§**ï¼šAçº§ï¼ˆæ¨¡å—åŒ–è®¾è®¡ï¼Œè¯¦ç»†æ—¥å¿—ï¼‰
5. **æ‰©å±•æ€§**ï¼šAçº§ï¼ˆæ˜“äºæ·»åŠ æ–°æœç´¢å¼•æ“ï¼‰

### ğŸ“ˆ é¢„æœŸæ•ˆæœ
åœ¨ä¾èµ–å®Œæ•´çš„ç¯å¢ƒä¸‹ï¼Œä¼˜åŒ–åçš„çˆ¬è™«ç³»ç»Ÿå¯ä»¥ï¼š
- **ç¨³å®šè¿è¡Œ**ï¼š24/7è¿ç»­å·¥ä½œ
- **é«˜æˆåŠŸç‡**ï¼š80-90%æœç´¢æˆåŠŸ
- **æ™ºèƒ½é€‚åº”**ï¼šè‡ªåŠ¨åº”å¯¹é¡µé¢å˜åŒ–
- **ä¾¿äºç»´æŠ¤**ï¼šè¯¦ç»†æ—¥å¿—å’ŒçŠ¶æ€ç›‘æ§

### ğŸš€ æ¨èä½¿ç”¨åœºæ™¯
1. **å­¦æœ¯ç ”ç©¶**ï¼šæ”¶é›†æœç´¢å¼•æ“ç»“æœæ•°æ®
2. **å¸‚åœºåˆ†æ**ï¼šç›‘æ§å…³é”®è¯æ’åå˜åŒ–
3. **ç«å“åˆ†æ**ï¼šè·Ÿè¸ªç«äº‰å¯¹æ‰‹ä¿¡æ¯
4. **èˆ†æƒ…ç›‘æ§**ï¼šå®æ—¶æœç´¢ç›¸å…³è¯é¢˜

**æ³¨æ„äº‹é¡¹**ï¼šè¯·éµå®ˆå„æœç´¢å¼•æ“çš„æœåŠ¡æ¡æ¬¾ï¼Œåˆç†ä½¿ç”¨çˆ¬è™«åŠŸèƒ½ï¼Œé¿å…å¯¹æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›ã€‚