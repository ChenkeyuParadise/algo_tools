# 关键词爬虫工具

一个功能完整的定时爬取互联网数据关键词的工具，支持多搜索引擎、定时任务、数据统计和可视化。

## ✨ 主要功能

### 🕷️ 多搜索引擎爬虫
- **支持多个热门搜索引擎**: 百度、必应、搜狗
- **智能解析**: 自动提取搜索结果的标题、链接和摘要
- **反爬虫策略**: 随机User-Agent、请求延迟、重试机制
- **并发控制**: 支持多页搜索，智能控制请求频率

### ⏰ 定时任务调度
- **灵活的调度策略**: 支持间隔执行和Cron表达式
- **任务管理**: 启动、暂停、恢复、删除任务
- **自动重试**: 失败任务自动重试机制
- **状态监控**: 实时任务状态和执行历史

### 📊 数据统计与可视化
- **多维度统计**: 按关键词、搜索引擎、时间维度统计
- **丰富的图表**: 时间线图、对比图、热力图、饼图等
- **交互式仪表板**: 基于Plotly的动态图表
- **数据导出**: 支持图片和HTML格式导出

### 🎛️ Web管理界面
- **直观的管理界面**: 基于Bootstrap的现代化UI
- **实时监控**: 任务状态、数据统计实时更新
- **关键词管理**: 添加、删除、激活关键词
- **可视化展示**: 集成各种图表和报告

## 🚀 快速开始

### 环境要求
- Python 3.7+
- 操作系统: Windows/Linux/macOS

### 安装依赖
```bash
pip install -r requirements.txt
```

### 初始化系统
```bash
python main.py init
```

### 启动Web界面
```bash
python main.py web
```
然后在浏览器中访问 http://localhost:5000

## 📖 详细使用指南

### 命令行接口

#### 1. 系统初始化
```bash
python main.py init
```
- 创建必要的目录结构
- 初始化数据库
- 添加默认关键词

#### 2. 启动Web界面
```bash
# 使用默认配置
python main.py web

# 自定义配置
python main.py web --host 0.0.0.0 --port 8080 --debug
```

#### 3. 执行搜索任务
```bash
# 搜索默认关键词
python main.py crawl

# 搜索指定关键词
python main.py crawl -k "人工智能" "机器学习" "深度学习"

# 搜索多页结果
python main.py crawl -k "Python" -p 3
```

#### 4. 启动定时任务
```bash
python main.py schedule
```
默认任务：
- 每小时执行关键词搜索
- 每天获取热门关键词
- 每周清理旧数据

#### 5. 生成可视化图表
```bash
# 生成最近7天的图表
python main.py visualize

# 生成最近30天的图表
python main.py visualize -d 30
```

#### 6. 查看系统状态
```bash
python main.py status
```

### Web界面功能

#### 📱 主页仪表板
- 系统概览统计
- 热门关键词排行
- 搜索引擎性能对比
- 快速操作按钮

#### 🏷️ 关键词管理
- 查看所有关键词
- 添加新关键词
- 激活/停用关键词
- 批量操作

#### ⏰ 任务管理
- 查看所有定时任务
- 立即执行任务
- 暂停/恢复任务
- 任务执行历史

#### 📊 数据统计
- 搜索结果统计
- 任务执行统计
- 成功率分析
- 时间趋势分析

#### 📈 数据可视化
- 搜索结果时间线
- 关键词对比图
- 搜索引擎性能图
- 活动热力图
- 交互式仪表板

## 🔧 配置说明

### 搜索引擎配置
可以在 `keyword_crawler/config.py` 中配置搜索引擎：

```python
SEARCH_ENGINES = {
    "baidu": {
        "name": "百度",
        "search_url": "https://www.baidu.com/s?wd={keyword}&pn={page}",
        "result_selector": ".result",
        "title_selector": "h3 a",
        "link_selector": "h3 a",
        "snippet_selector": ".c-abstract",
        "enabled": True
    }
    # 更多搜索引擎配置...
}
```

### 默认关键词
```python
DEFAULT_KEYWORDS = [
    "人工智能",
    "机器学习", 
    "深度学习",
    "Python编程",
    "数据科学",
    # 更多关键词...
]
```

### 定时任务配置
```python
SCHEDULER_CONFIG = {
    "default_interval": 3600,  # 默认1小时执行一次
    "max_workers": 5,
    "timezone": "Asia/Shanghai"
}
```

## 📂 项目结构

```
关键词爬虫工具/
├── keyword_crawler/          # 主要模块
│   ├── __init__.py          # 模块初始化
│   ├── config.py            # 配置文件
│   ├── database.py          # 数据库管理
│   ├── crawler.py           # 爬虫核心
│   ├── scheduler.py         # 任务调度
│   ├── visualizer.py        # 数据可视化
│   └── web_app.py           # Web应用
├── data/                    # 数据目录
│   └── crawler_data.db      # SQLite数据库
├── logs/                    # 日志目录
├── results/                 # 结果目录
│   ├── *.png               # 图表文件
│   └── *.html              # 交互式图表
├── main.py                  # 主程序
├── requirements.txt         # 依赖文件
└── README.md               # 说明文档
```

## 🗄️ 数据库设计

### 主要数据表

#### search_tasks - 搜索任务表
- id: 任务ID
- keyword: 关键词
- search_engine: 搜索引擎
- status: 任务状态
- created_at, started_at, completed_at: 时间戳
- error_message: 错误信息

#### search_results - 搜索结果表
- id: 结果ID
- task_id: 关联任务ID
- keyword: 关键词
- search_engine: 搜索引擎
- title: 标题
- url: 链接
- snippet: 摘要
- rank_position: 排名位置
- created_at: 创建时间

#### keywords - 关键词表
- id: 关键词ID
- keyword: 关键词内容
- is_active: 是否激活
- created_at: 创建时间
- last_searched: 最后搜索时间

#### statistics - 统计数据表
- 各种维度的统计数据
- 用于快速查询和图表生成

## 📊 数据可视化功能

### 1. 搜索结果时间线图
- 展示各搜索引擎的搜索结果数量趋势
- 支持自定义时间范围
- 多引擎对比

### 2. 关键词对比图
- 水平柱状图展示关键词热度
- 按搜索结果数量排序
- 数值标签显示

### 3. 搜索引擎性能图
- 多子图展示：任务总数、成功率、完成情况
- 饼图显示总体分布
- 进度条展示成功率

### 4. 每日活动热力图
- 热力图展示每日搜索活动
- 按搜索引擎和日期维度
- 颜色深浅表示活跃度

### 5. 交互式仪表板
- 基于Plotly的动态图表
- 支持缩放、筛选、悬停
- 多图表联动展示

## 🔒 安全与性能

### 反爬虫策略
- 随机User-Agent轮换
- 请求间隔控制
- 自动重试机制
- IP代理支持（可扩展）

### 性能优化
- 数据库索引优化
- 批量数据插入
- 缓存热点数据
- 异步任务处理

### 错误处理
- 完善的异常捕获
- 详细的错误日志
- 自动错误恢复
- 用户友好的错误提示

## 🚨 注意事项

1. **合法使用**: 请遵守目标网站的robots.txt和使用条款
2. **请求频率**: 避免过于频繁的请求，建议设置合理的延迟
3. **数据量**: 大量数据爬取时注意存储空间和处理性能
4. **网络环境**: 确保网络连接稳定，部分网站可能需要代理

## 🔧 故障排除

### 常见问题

1. **无法访问某些网站**
   - 检查网络连接
   - 尝试使用代理
   - 检查防火墙设置

2. **搜索结果为空**
   - 检查网站页面结构是否变化
   - 更新CSS选择器
   - 检查关键词是否有效

3. **数据库错误**
   - 检查数据库文件权限
   - 确保磁盘空间充足
   - 重新初始化数据库

4. **Web界面无法访问**
   - 检查端口是否被占用
   - 确认防火墙设置
   - 查看错误日志

## 🎯 未来规划

- [ ] 支持更多搜索引擎
- [ ] 添加代理池功能
- [ ] 实现分布式爬取
- [ ] 增强数据分析功能
- [ ] 支持自定义爬虫规则
- [ ] 添加邮件通知功能
- [ ] 移动端适配
- [ ] Docker容器化部署

## 📄 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 🤝 贡献

欢迎提交Issue和Pull Request来帮助改进项目！

## 📧 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件
- 参与讨论

---

**⚠️ 免责声明**: 本工具仅供学习和研究使用，用户使用时请遵守相关法律法规和网站使用条款。